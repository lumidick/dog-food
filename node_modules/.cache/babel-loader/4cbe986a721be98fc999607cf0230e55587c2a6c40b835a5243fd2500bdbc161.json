{"ast":null,"code":"import _regeneratorRuntime from\"/home/titus/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/dog-food/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/home/titus/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/dog-food/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/titus/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/dog-food/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import{SORTED}from'../../utils/contants';import{isLiked}from'../../utils/product';import{isError}from'../../utils/store';export var fetchProducts=createAsyncThunk('products/fetchProducts',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_,_ref){var rejectWithValue,fulfillWithValue,dispatch,getState,api,_getState,user,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:rejectWithValue=_ref.rejectWithValue,fulfillWithValue=_ref.fulfillWithValue,dispatch=_ref.dispatch,getState=_ref.getState,api=_ref.extra;_context.prev=1;_getState=getState(),user=_getState.user;console.log(user);_context.next=6;return api.getProductList();case 6:data=_context.sent;return _context.abrupt(\"return\",fulfillWithValue(_objectSpread(_objectSpread({},data),{},{currentUser:user.data})));case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);return _context.abrupt(\"return\",rejectWithValue(_context.t0));case 13:case\"end\":return _context.stop();}},_callee,null,[[1,10]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var fetchChangeLikeProduct=createAsyncThunk('products/fetchChangeLikeProduct',/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(product,_ref3){var rejectWithValue,fulfillWithValue,dispatch,getState,api,_getState2,user,liked,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:rejectWithValue=_ref3.rejectWithValue,fulfillWithValue=_ref3.fulfillWithValue,dispatch=_ref3.dispatch,getState=_ref3.getState,api=_ref3.extra;_context2.prev=1;_getState2=getState(),user=_getState2.user;liked=isLiked(product.likes,user.data._id);_context2.next=6;return api.changeLikeProduct(product._id,liked);case 6:data=_context2.sent;return _context2.abrupt(\"return\",fulfillWithValue({product:data,liked:liked}));case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](1);return _context2.abrupt(\"return\",rejectWithValue(_context2.t0));case 13:case\"end\":return _context2.stop();}},_callee2,null,[[1,10]]);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());var initialState={data:[],favoriteProducts:[],currentSort:\"\",total:null,loading:true,error:null};var productsSlice=createSlice({name:'products',initialState:initialState,reducers:{sortedProducts:function sortedProducts(state,action){switch(action.payload){case SORTED.LOW:state.data=state.data.sort(function(a,b){return b.price-a.price;});state.currentSort=action.payload;break;case SORTED.CHEAP:state.data=state.data.sort(function(a,b){return a.price-b.price;});state.currentSort=action.payload;break;case SORTED.SALE:state.data=state.data.sort(function(a,b){return b.discount-a.discount;});state.currentSort=action.payload;break;default:state.data=state.data.sort(function(a,b){return b.discount-a.discount;});state.currentSort=SORTED.SALE;}}},extraReducers:function extraReducers(builder){builder.addCase(fetchProducts.pending,function(state,action){state.loading=true;state.error=null;}).addCase(fetchProducts.fulfilled,function(state,action){var _action$payload=action.payload,products=_action$payload.products,total=_action$payload.total,currentUser=_action$payload.currentUser;state.data=products;state.favoriteProducts=products.filter(function(item){return isLiked(item.likes,currentUser._id);});state.total=total;state.loading=false;}).addCase(fetchChangeLikeProduct.fulfilled,function(state,action){var _action$payload2=action.payload,liked=_action$payload2.liked,product=_action$payload2.product;state.data=state.data.map(function(cardState){return cardState._id===product._id?product:cardState;});if(!liked){state.favoriteProducts.push(product);}else{state.favoriteProducts=state.favoriteProducts.filter(function(card){return card._id!==product._id;});}}).addMatcher(isError,function(state,action){state.error=action.payload;state.loading=false;});}});var sortedProducts=productsSlice.actions.sortedProducts;export{sortedProducts};export default productsSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","SORTED","isLiked","isError","fetchProducts","_","rejectWithValue","fulfillWithValue","dispatch","getState","api","extra","user","console","log","getProductList","data","currentUser","fetchChangeLikeProduct","product","liked","likes","_id","changeLikeProduct","initialState","favoriteProducts","currentSort","total","loading","error","productsSlice","name","reducers","sortedProducts","state","action","payload","LOW","sort","a","b","price","CHEAP","SALE","discount","extraReducers","builder","addCase","pending","fulfilled","products","filter","item","map","cardState","push","card","addMatcher","actions","reducer"],"sources":["/home/titus/Рабочий стол/dog-food/src/storage/products/productsSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { SORTED } from '../../utils/contants';\nimport { isLiked } from '../../utils/product';\nimport { isError } from '../../utils/store';\n\nexport const fetchProducts = createAsyncThunk(\n  'products/fetchProducts',\n  async function (\n    _,\n    { rejectWithValue, fulfillWithValue, dispatch, getState, extra: api }\n  ) {\n    try {\n      const { user } = getState();\n      console.log(user);\n      const data = await api.getProductList();\n      return fulfillWithValue({...data, currentUser: user.data});\n    } catch (error) {\n      return rejectWithValue(error);\n    }\n  }\n);\n\nexport const fetchChangeLikeProduct = createAsyncThunk(\n  'products/fetchChangeLikeProduct',\n  async function (product,{ rejectWithValue, fulfillWithValue, dispatch, getState, extra: api }) {\n    try {\n      const { user } = getState();\n      const liked = isLiked(product.likes, user.data._id);\n      const data = await api.changeLikeProduct(product._id, liked);\n      return fulfillWithValue({product: data, liked});\n    } catch (error) {\n      return rejectWithValue(error);\n    }\n  }\n);\n\nconst initialState = {\n  data: [],\n  favoriteProducts: [],\n  currentSort: \"\",\n  total: null,\n  loading: true,\n  error: null,\n};\n\nconst productsSlice = createSlice({\n  name: 'products',\n  initialState,\n  reducers: {\n    sortedProducts: (state, action) => {\n      switch (action.payload) {\n        case SORTED.LOW:  \n          state.data = state.data.sort((a, b) => b.price - a.price);\n          state.currentSort = action.payload;\n          break;\n        case SORTED.CHEAP: \n          state.data = state.data.sort((a, b) => a.price - b.price);\n          state.currentSort = action.payload;\n          break;\n        case SORTED.SALE: \n          state.data = state.data.sort((a, b) => b.discount - a.discount);\n          state.currentSort = action.payload;\n          break;\n        default: \n          state.data = state.data.sort((a, b) => b.discount - a.discount);\n          state.currentSort = SORTED.SALE;\n      }\n    }\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(fetchProducts.pending, (state, action) => {\n        state.loading = true;\n        state.error = null;\n      })\n      .addCase(fetchProducts.fulfilled, (state, action) => {\n        const {products, total, currentUser} = action.payload\n        state.data = products;\n        state.favoriteProducts = products.filter(item => isLiked(item.likes, currentUser._id));\n        state.total = total;\n        state.loading = false;\n      })\n      .addCase(fetchChangeLikeProduct.fulfilled, (state, action) => {\n        const { liked, product } = action.payload;\n\n        state.data = state.data.map(cardState => {\n          return cardState._id === product._id ? product : cardState\n        })\n\n        if (!liked) {\n          state.favoriteProducts.push(product);\n        } else {\n          state.favoriteProducts = state.favoriteProducts.filter(card => card._id !== product._id)\n        }\n      })\n      .addMatcher(isError, (state, action) => {\n        state.error = action.payload;\n        state.loading = false;\n      })\n  },\n});\n\nexport const {sortedProducts} = productsSlice.actions;\nexport default productsSlice.reducer;\n"],"mappings":"yhBAAA,OAASA,WAAW,CAAEC,gBAAgB,KAAQ,kBAAkB,CAChE,OAASC,MAAM,KAAQ,sBAAsB,CAC7C,OAASC,OAAO,KAAQ,qBAAqB,CAC7C,OAASC,OAAO,KAAQ,mBAAmB,CAE3C,MAAO,IAAMC,cAAa,CAAGJ,gBAAgB,CAC3C,wBAAwB,6FACxB,iBACEK,CAAC,uMACCC,eAAe,MAAfA,eAAe,CAAEC,gBAAgB,MAAhBA,gBAAgB,CAAEC,QAAQ,MAARA,QAAQ,CAAEC,QAAQ,MAARA,QAAQ,CAASC,GAAG,MAAVC,KAAK,2BAG3CF,QAAQ,EAAE,CAAnBG,IAAI,WAAJA,IAAI,CACZC,OAAO,CAACC,GAAG,CAACF,IAAI,CAAC,CAAC,sBACCF,IAAG,CAACK,cAAc,EAAE,QAAjCC,IAAI,+CACHT,gBAAgB,gCAAKS,IAAI,MAAEC,WAAW,CAAEL,IAAI,CAACI,IAAI,GAAE,4FAEnDV,eAAe,aAAO,sEAEhC,oEACF,CAED,MAAO,IAAMY,uBAAsB,CAAGlB,gBAAgB,CACpD,iCAAiC,6FACjC,kBAAgBmB,OAAO,mNAAGb,eAAe,OAAfA,eAAe,CAAEC,gBAAgB,OAAhBA,gBAAgB,CAAEC,QAAQ,OAARA,QAAQ,CAAEC,QAAQ,OAARA,QAAQ,CAASC,GAAG,OAAVC,KAAK,6BAEjEF,QAAQ,EAAE,CAAnBG,IAAI,YAAJA,IAAI,CACNQ,KAAK,CAAGlB,OAAO,CAACiB,OAAO,CAACE,KAAK,CAAET,IAAI,CAACI,IAAI,CAACM,GAAG,CAAC,wBAChCZ,IAAG,CAACa,iBAAiB,CAACJ,OAAO,CAACG,GAAG,CAAEF,KAAK,CAAC,QAAtDJ,IAAI,iDACHT,gBAAgB,CAAC,CAACY,OAAO,CAAEH,IAAI,CAAEI,KAAK,CAALA,KAAK,CAAC,CAAC,gGAExCd,eAAe,cAAO,wEAEhC,qEACF,CAED,GAAMkB,aAAY,CAAG,CACnBR,IAAI,CAAE,EAAE,CACRS,gBAAgB,CAAE,EAAE,CACpBC,WAAW,CAAE,EAAE,CACfC,KAAK,CAAE,IAAI,CACXC,OAAO,CAAE,IAAI,CACbC,KAAK,CAAE,IACT,CAAC,CAED,GAAMC,cAAa,CAAG/B,WAAW,CAAC,CAChCgC,IAAI,CAAE,UAAU,CAChBP,YAAY,CAAZA,YAAY,CACZQ,QAAQ,CAAE,CACRC,cAAc,CAAE,wBAACC,KAAK,CAAEC,MAAM,CAAK,CACjC,OAAQA,MAAM,CAACC,OAAO,EACpB,IAAKnC,OAAM,CAACoC,GAAG,CACbH,KAAK,CAAClB,IAAI,CAAGkB,KAAK,CAAClB,IAAI,CAACsB,IAAI,CAAC,SAACC,CAAC,CAAEC,CAAC,QAAKA,EAAC,CAACC,KAAK,CAAGF,CAAC,CAACE,KAAK,GAAC,CACzDP,KAAK,CAACR,WAAW,CAAGS,MAAM,CAACC,OAAO,CAClC,MACF,IAAKnC,OAAM,CAACyC,KAAK,CACfR,KAAK,CAAClB,IAAI,CAAGkB,KAAK,CAAClB,IAAI,CAACsB,IAAI,CAAC,SAACC,CAAC,CAAEC,CAAC,QAAKD,EAAC,CAACE,KAAK,CAAGD,CAAC,CAACC,KAAK,GAAC,CACzDP,KAAK,CAACR,WAAW,CAAGS,MAAM,CAACC,OAAO,CAClC,MACF,IAAKnC,OAAM,CAAC0C,IAAI,CACdT,KAAK,CAAClB,IAAI,CAAGkB,KAAK,CAAClB,IAAI,CAACsB,IAAI,CAAC,SAACC,CAAC,CAAEC,CAAC,QAAKA,EAAC,CAACI,QAAQ,CAAGL,CAAC,CAACK,QAAQ,GAAC,CAC/DV,KAAK,CAACR,WAAW,CAAGS,MAAM,CAACC,OAAO,CAClC,MACF,QACEF,KAAK,CAAClB,IAAI,CAAGkB,KAAK,CAAClB,IAAI,CAACsB,IAAI,CAAC,SAACC,CAAC,CAAEC,CAAC,QAAKA,EAAC,CAACI,QAAQ,CAAGL,CAAC,CAACK,QAAQ,GAAC,CAC/DV,KAAK,CAACR,WAAW,CAAGzB,MAAM,CAAC0C,IAAI,CAAC,CAEtC,CACF,CAAC,CACDE,aAAa,CAAE,uBAACC,OAAO,CAAK,CAC1BA,OAAO,CACJC,OAAO,CAAC3C,aAAa,CAAC4C,OAAO,CAAE,SAACd,KAAK,CAAEC,MAAM,CAAK,CACjDD,KAAK,CAACN,OAAO,CAAG,IAAI,CACpBM,KAAK,CAACL,KAAK,CAAG,IAAI,CACpB,CAAC,CAAC,CACDkB,OAAO,CAAC3C,aAAa,CAAC6C,SAAS,CAAE,SAACf,KAAK,CAAEC,MAAM,CAAK,CACnD,oBAAuCA,MAAM,CAACC,OAAO,CAA9Cc,QAAQ,iBAARA,QAAQ,CAAEvB,KAAK,iBAALA,KAAK,CAAEV,WAAW,iBAAXA,WAAW,CACnCiB,KAAK,CAAClB,IAAI,CAAGkC,QAAQ,CACrBhB,KAAK,CAACT,gBAAgB,CAAGyB,QAAQ,CAACC,MAAM,CAAC,SAAAC,IAAI,QAAIlD,QAAO,CAACkD,IAAI,CAAC/B,KAAK,CAAEJ,WAAW,CAACK,GAAG,CAAC,GAAC,CACtFY,KAAK,CAACP,KAAK,CAAGA,KAAK,CACnBO,KAAK,CAACN,OAAO,CAAG,KAAK,CACvB,CAAC,CAAC,CACDmB,OAAO,CAAC7B,sBAAsB,CAAC+B,SAAS,CAAE,SAACf,KAAK,CAAEC,MAAM,CAAK,CAC5D,qBAA2BA,MAAM,CAACC,OAAO,CAAjChB,KAAK,kBAALA,KAAK,CAAED,OAAO,kBAAPA,OAAO,CAEtBe,KAAK,CAAClB,IAAI,CAAGkB,KAAK,CAAClB,IAAI,CAACqC,GAAG,CAAC,SAAAC,SAAS,CAAI,CACvC,MAAOA,UAAS,CAAChC,GAAG,GAAKH,OAAO,CAACG,GAAG,CAAGH,OAAO,CAAGmC,SAAS,CAC5D,CAAC,CAAC,CAEF,GAAI,CAAClC,KAAK,CAAE,CACVc,KAAK,CAACT,gBAAgB,CAAC8B,IAAI,CAACpC,OAAO,CAAC,CACtC,CAAC,IAAM,CACLe,KAAK,CAACT,gBAAgB,CAAGS,KAAK,CAACT,gBAAgB,CAAC0B,MAAM,CAAC,SAAAK,IAAI,QAAIA,KAAI,CAAClC,GAAG,GAAKH,OAAO,CAACG,GAAG,GAAC,CAC1F,CACF,CAAC,CAAC,CACDmC,UAAU,CAACtD,OAAO,CAAE,SAAC+B,KAAK,CAAEC,MAAM,CAAK,CACtCD,KAAK,CAACL,KAAK,CAAGM,MAAM,CAACC,OAAO,CAC5BF,KAAK,CAACN,OAAO,CAAG,KAAK,CACvB,CAAC,CAAC,CACN,CACF,CAAC,CAAC,CAEK,GAAOK,eAAc,CAAIH,aAAa,CAAC4B,OAAO,CAAvCzB,cAAc,CAA0B,uBACtD,cAAeH,cAAa,CAAC6B,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}