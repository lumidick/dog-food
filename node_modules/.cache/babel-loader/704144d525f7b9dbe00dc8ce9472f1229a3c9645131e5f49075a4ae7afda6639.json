{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { SORTED } from '../../utils/contants';\nimport { isLiked } from '../../utils/product';\nimport { isError } from '../../utils/store';\nexport const fetchProducts = createAsyncThunk('products/fetchProducts', async function (_, _ref) {\n  let {\n    rejectWithValue,\n    fulfillWithValue,\n    dispatch,\n    getState,\n    extra: api\n  } = _ref;\n  try {\n    const {\n      user\n    } = getState();\n    console.log(user);\n    const data = await api.getProductList();\n    return fulfillWithValue({\n      ...data,\n      currentUser: user.data\n    });\n  } catch (error) {\n    return rejectWithValue(error);\n  }\n});\nexport const fetchChangeLikeProduct = createAsyncThunk('products/fetchChangeLikeProduct', async function (product, _ref2) {\n  let {\n    rejectWithValue,\n    fulfillWithValue,\n    dispatch,\n    getState,\n    extra: api\n  } = _ref2;\n  try {\n    const {\n      user\n    } = getState();\n    const liked = isLiked(product.likes, user.data._id);\n    const data = await api.changeLikeProduct(product._id, liked);\n    return fulfillWithValue({\n      product: data,\n      liked\n    });\n  } catch (error) {\n    return rejectWithValue(error);\n  }\n});\nconst initialState = {\n  data: [],\n  favoriteProducts: [],\n  currentSort: \"\",\n  total: null,\n  loading: true,\n  error: null\n};\nconst productsSlice = createSlice({\n  name: 'products',\n  initialState,\n  reducers: {\n    sortedProducts: (state, action) => {\n      switch (action.payload) {\n        case SORTED.LOW:\n          state.data = state.data.sort((a, b) => b.price - a.price);\n          state.currentSort = action.payload;\n          break;\n        case SORTED.CHEAP:\n          state.data = state.data.sort((a, b) => a.price - b.price);\n          state.currentSort = action.payload;\n          break;\n        case SORTED.SALE:\n          state.data = state.data.sort((a, b) => b.discount - a.discount);\n          state.currentSort = action.payload;\n          break;\n        default:\n          state.data = state.data.sort((a, b) => b.discount - a.discount);\n          state.currentSort = SORTED.SALE;\n      }\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchProducts.pending, (state, action) => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchProducts.fulfilled, (state, action) => {\n      const {\n        products,\n        total,\n        currentUser\n      } = action.payload;\n      state.data = products;\n      state.favoriteProducts = products.filter(item => isLiked(item.likes, currentUser._id));\n      state.total = total;\n      state.loading = false;\n    }).addCase(fetchChangeLikeProduct.fulfilled, (state, action) => {\n      const {\n        liked,\n        product\n      } = action.payload;\n      state.data = state.data.map(cardState => {\n        return cardState._id === product._id ? product : cardState;\n      });\n      if (!liked) {\n        state.favoriteProducts.push(product);\n      } else {\n        state.favoriteProducts = state.favoriteProducts.filter(card => card._id !== product._id);\n      }\n    }).addMatcher(isError, (state, action) => {\n      state.error = action.payload;\n      state.loading = false;\n    });\n  }\n});\nexport const {\n  sortedProducts\n} = productsSlice.actions;\nexport default productsSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","SORTED","isLiked","isError","fetchProducts","_","rejectWithValue","fulfillWithValue","dispatch","getState","extra","api","user","console","log","data","getProductList","currentUser","error","fetchChangeLikeProduct","product","liked","likes","_id","changeLikeProduct","initialState","favoriteProducts","currentSort","total","loading","productsSlice","name","reducers","sortedProducts","state","action","payload","LOW","sort","a","b","price","CHEAP","SALE","discount","extraReducers","builder","addCase","pending","fulfilled","products","filter","item","map","cardState","push","card","addMatcher","actions","reducer"],"sources":["/home/titus/Рабочий стол/dog-food/src/storage/products/productsSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { SORTED } from '../../utils/contants';\nimport { isLiked } from '../../utils/product';\nimport { isError } from '../../utils/store';\n\nexport const fetchProducts = createAsyncThunk(\n  'products/fetchProducts',\n  async function (\n    _,\n    { rejectWithValue, fulfillWithValue, dispatch, getState, extra: api }\n  ) {\n    try {\n      const { user } = getState();\n      console.log(user);\n      const data = await api.getProductList();\n      return fulfillWithValue({...data, currentUser: user.data});\n    } catch (error) {\n      return rejectWithValue(error);\n    }\n  }\n);\n\nexport const fetchChangeLikeProduct = createAsyncThunk(\n  'products/fetchChangeLikeProduct',\n  async function (product,{ rejectWithValue, fulfillWithValue, dispatch, getState, extra: api }) {\n    try {\n      const { user } = getState();\n      const liked = isLiked(product.likes, user.data._id);\n      const data = await api.changeLikeProduct(product._id, liked);\n      return fulfillWithValue({product: data, liked});\n    } catch (error) {\n      return rejectWithValue(error);\n    }\n  }\n);\n\nconst initialState = {\n  data: [],\n  favoriteProducts: [],\n  currentSort: \"\",\n  total: null,\n  loading: true,\n  error: null,\n};\n\nconst productsSlice = createSlice({\n  name: 'products',\n  initialState,\n  reducers: {\n    sortedProducts: (state, action) => {\n      switch (action.payload) {\n        case SORTED.LOW:  \n          state.data = state.data.sort((a, b) => b.price - a.price);\n          state.currentSort = action.payload;\n          break;\n        case SORTED.CHEAP: \n          state.data = state.data.sort((a, b) => a.price - b.price);\n          state.currentSort = action.payload;\n          break;\n        case SORTED.SALE: \n          state.data = state.data.sort((a, b) => b.discount - a.discount);\n          state.currentSort = action.payload;\n          break;\n        default: \n          state.data = state.data.sort((a, b) => b.discount - a.discount);\n          state.currentSort = SORTED.SALE;\n      }\n    }\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(fetchProducts.pending, (state, action) => {\n        state.loading = true;\n        state.error = null;\n      })\n      .addCase(fetchProducts.fulfilled, (state, action) => {\n        const {products, total, currentUser} = action.payload\n        state.data = products;\n        state.favoriteProducts = products.filter(item => isLiked(item.likes, currentUser._id));\n        state.total = total;\n        state.loading = false;\n      })\n      .addCase(fetchChangeLikeProduct.fulfilled, (state, action) => {\n        const { liked, product } = action.payload;\n\n        state.data = state.data.map(cardState => {\n          return cardState._id === product._id ? product : cardState\n        })\n\n        if (!liked) {\n          state.favoriteProducts.push(product);\n        } else {\n          state.favoriteProducts = state.favoriteProducts.filter(card => card._id !== product._id)\n        }\n      })\n      .addMatcher(isError, (state, action) => {\n        state.error = action.payload;\n        state.loading = false;\n      })\n  },\n});\n\nexport const {sortedProducts} = productsSlice.actions;\nexport default productsSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}